{
  "captainVersion": 4,
  "services": {
    "$$cap_appname-db": {
      "image": "supabase/postgres:$$cap_postgres_version",
      "volumes": [
        "$$cap_appname-db-data:/var/lib/postgresql/data"
      ],
      "environment": {
        "POSTGRES_USER": "supabase_admin",
        "POSTGRES_PASSWORD": "$$cap_postgres_password",
        "POSTGRES_DB": "postgres",
        "POSTGRES_HOST": "/var/run/postgresql",
        "PGPORT": "5432",
        "POSTGRES_PORT": "5432"
      },
      "restart": "always",
      "caproverExtra": {
        "notExposeAsWebApp": "true"
      }
    },
    "$$cap_appname-meta": {
      "depends_on": ["$$cap_appname-db"],
      "image": "supabase/postgres-meta:$$cap_meta_version",
      "environment": {
        "PG_META_PORT": "8080",
        "PG_META_DB_HOST": "srv-captain--$$cap_appname-db",
        "PG_META_DB_PORT": "5432",
        "PG_META_DB_NAME": "postgres",
        "PG_META_DB_USER": "supabase_admin",
        "PG_META_DB_PASSWORD": "$$cap_postgres_password"
      },
      "restart": "always",
      "caproverExtra": {
        "containerHttpPort": "8080",
        "notExposeAsWebApp": "true"
      }
    },
    "$$cap_appname-auth": {
      "depends_on": ["$$cap_appname-db"],
      "image": "supabase/gotrue:$$cap_gotrue_version",
      "environment": {
        "GOTRUE_API_HOST": "0.0.0.0",
        "GOTRUE_API_PORT": "9999",
        "API_EXTERNAL_URL": "https://$$cap_appname-auth.$$cap_root_domain",
        "GOTRUE_DB_DRIVER": "postgres",
        "GOTRUE_DB_DATABASE_URL": "postgres://supabase_admin:$$cap_postgres_password@srv-captain--$$cap_appname-db:5432/postgres?search_path=auth",
        "GOTRUE_SITE_URL": "https://$$cap_appname-studio.$$cap_root_domain",
        "GOTRUE_URI_ALLOW_LIST": "*",
        "GOTRUE_DISABLE_SIGNUP": "false",
        "GOTRUE_JWT_ADMIN_ROLES": "service_role",
        "GOTRUE_JWT_AUD": "authenticated",
        "GOTRUE_JWT_DEFAULT_GROUP_NAME": "authenticated",
        "GOTRUE_JWT_EXP": "3600",
        "GOTRUE_JWT_SECRET": "$$cap_jwt_secret",
        "GOTRUE_EXTERNAL_EMAIL_ENABLED": "true",
        "GOTRUE_MAILER_AUTOCONFIRM": "true",
        "GOTRUE_SMTP_ADMIN_EMAIL": "admin@example.com",
        "GOTRUE_MAILER_URLPATHS_INVITE": "/auth/v1/verify",
        "GOTRUE_MAILER_URLPATHS_CONFIRMATION": "/auth/v1/verify",
        "GOTRUE_MAILER_URLPATHS_RECOVERY": "/auth/v1/verify",
        "GOTRUE_MAILER_URLPATHS_EMAIL_CHANGE": "/auth/v1/verify"
      },
      "restart": "always",
      "caproverExtra": {
        "containerHttpPort": "9999"
      }
    },
    "$$cap_appname-rest": {
      "depends_on": ["$$cap_appname-db"],
      "image": "postgrest/postgrest:$$cap_postgrest_version",
      "environment": {
        "PGRST_DB_URI": "postgres://supabase_admin:$$cap_postgres_password@srv-captain--$$cap_appname-db:5432/postgres",
        "PGRST_DB_SCHEMAS": "public,storage,graphql_public",
        "PGRST_DB_ANON_ROLE": "anon",
        "PGRST_JWT_SECRET": "$$cap_jwt_secret",
        "PGRST_DB_USE_LEGACY_GUCS": "false",
        "PGRST_APP_SETTINGS_JWT_SECRET": "$$cap_jwt_secret",
        "PGRST_APP_SETTINGS_JWT_EXP": "3600"
      },
      "restart": "always",
      "caproverExtra": {
        "containerHttpPort": "3000"
      }
    },
    "$$cap_appname-studio": {
      "depends_on": ["$$cap_appname-db", "$$cap_appname-meta"],
      "image": "supabase/studio:$$cap_studio_version",
      "environment": {
        "STUDIO_PG_META_URL": "http://srv-captain--$$cap_appname-meta:8080",
        "POSTGRES_PASSWORD": "$$cap_postgres_password",
        "DEFAULT_ORGANIZATION_NAME": "Default Org",
        "DEFAULT_PROJECT_NAME": "Default Project",
        "SUPABASE_URL": "https://$$cap_appname-rest.$$cap_root_domain",
        "SUPABASE_PUBLIC_URL": "https://$$cap_appname-rest.$$cap_root_domain",
        "SUPABASE_ANON_KEY": "$$cap_anon_key",
        "SUPABASE_SERVICE_KEY": "$$cap_service_role_key",
        "AUTH_JWT_SECRET": "$$cap_jwt_secret",
        "NEXT_PUBLIC_ENABLE_LOGS": "false",
        "NEXT_ANALYTICS_BACKEND_PROVIDER": "postgres",
        "HOSTNAME": "0.0.0.0"
      },
      "restart": "always",
      "caproverExtra": {
        "containerHttpPort": "3000"
      }
    }
  },
  "caproverOneClickApp": {
    "variables": [
      {
        "id": "$$cap_postgres_version",
        "label": "PostgreSQL Version",
        "defaultValue": "15.8.1.060",
        "description": "Supabase PostgreSQL version",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_meta_version",
        "label": "Postgres-Meta Version",
        "defaultValue": "v0.84.2",
        "description": "Postgres-Meta version",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_gotrue_version",
        "label": "GoTrue Version",
        "defaultValue": "v2.164.0",
        "description": "GoTrue (Auth) version",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_postgrest_version",
        "label": "PostgREST Version",
        "defaultValue": "v12.2.3",
        "description": "PostgREST version",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_studio_version",
        "label": "Studio Version",
        "defaultValue": "20241202-71e5240",
        "description": "Studio Dashboard version",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_postgres_password",
        "label": "PostgreSQL Password",
        "defaultValue": "$$cap_gen_random_hex(24)",
        "description": "Database password",
        "validRegex": "/.{12,}/"
      },
      {
        "id": "$$cap_jwt_secret",
        "label": "JWT Secret",
        "defaultValue": "super-secret-jwt-token-with-at-least-32-characters-long",
        "description": "JWT signing secret (min 32 chars). CHANGE THIS for production!",
        "validRegex": "/.{32,}/"
      },
      {
        "id": "$$cap_anon_key",
        "label": "Anon Key",
        "defaultValue": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNhcHJvdmVyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUxMjgwMDAsImV4cCI6MjA1MTAxNDgwMH0.00763WpyqyZyK6vecMvLrxuQDHH91atDUGsfeoeeovo",
        "description": "Anonymous API key (pre-generated for default JWT secret)",
        "validRegex": "/.+/"
      },
      {
        "id": "$$cap_service_role_key",
        "label": "Service Role Key",
        "defaultValue": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNhcHJvdmVyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTczNTEyODAwMCwiZXhwIjoyMDUxMDE0ODAwfQ.yOpgRAvSHw4dj-zXRqLE34eNn-gevXsbL5q67S-OxLA",
        "description": "Service role API key (pre-generated for default JWT secret)",
        "validRegex": "/.+/"
      }
    ],
    "instructions": {
      "start": "Supabase - Open Source Firebase Alternative\n\nDeploys: PostgreSQL, Auth, REST API, Studio\n\nReady to use with default JWT keys!\nFor production: change JWT Secret and regenerate keys.",
      "end": "Supabase deployed!\n\nServices:\n- Studio: https://$$cap_appname-studio.$$cap_root_domain\n- REST API: https://$$cap_appname-rest.$$cap_root_domain  \n- Auth: https://$$cap_appname-auth.$$cap_root_domain\n\nNEXT STEPS:\n1. Enable HTTPS on all apps\n2. Wait 2-3 minutes for DB initialization\n3. Access Studio\n\nCredentials:\n- DB Password: $$cap_postgres_password\n- JWT Secret: $$cap_jwt_secret\n\nFor production: change JWT secret and regenerate keys."
    },
    "displayName": "Supabase (Full Stack)",
    "isOfficial": false,
    "description": "Open source Firebase alternative - PostgreSQL, Auth, REST API, Studio",
    "documentation": "https://supabase.com/docs/guides/self-hosting"
  }
}
